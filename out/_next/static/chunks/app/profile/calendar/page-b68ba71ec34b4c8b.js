(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[133],{713:function(e,t,a){Promise.resolve().then(a.bind(a,6337))},6337:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return c}});var n=a(7437),r=a(2265),l=a(7648);let s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],i=["January","February","March","April","May","June","July","August","September","October","November","December"];function c(){let[e,t]=(0,r.useState)(()=>{let e=new Date;return new Date(e.getFullYear(),e.getMonth(),1)}),[a,c]=(0,r.useState)([]),[o,d]=(0,r.useState)(!0),[m,h]=(0,r.useState)(null),[u,p]=(0,r.useState)(null),[x,y]=(0,r.useState)(null),[f,b]=(0,r.useState)(""),[j,g]=(0,r.useState)(null),v=(0,r.useCallback)(async()=>{d(!0),h(null);try{let e=await fetch("/api/member/bookings");if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to load events")}let t=await e.json();c(Array.isArray(t)?t:[])}catch(e){h(e instanceof Error?e.message:"Failed to load events"),c([])}finally{d(!1)}},[]);(0,r.useEffect)(()=>{v()},[v]);let N=e.getFullYear(),w=e.getMonth(),k=i[w],S=new Date(N,w,1).getDay(),C=new Date(N,w+1,0).getDate(),T=Array(S).fill(null),D=Array.from({length:C},(e,t)=>t+1),z=new Date,E=e=>z.getFullYear()===N&&z.getMonth()===w&&z.getDate()===e,F=e=>a.some(t=>{let[a,n,r]=t.date.split("-").map(Number);return a===N&&n===w+1&&r===e}),A=e=>{y(e.eventId),b(e.athleteName)},I=()=>{y(null),b("")},M=async()=>{if(x&&f.trim()){p(null);try{let e=await fetch("/api/member/bookings",{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:x,athleteName:f.trim()})});if(!e.ok){let t=await e.json().catch(()=>({}));throw Error(t.error||"Failed to update")}p({type:"success",text:"Updated successfully."}),I(),await v()}catch(e){p({type:"error",text:e instanceof Error?e.message:"Failed to update"})}}},Y=e=>{e.canCancel&&g(e.eventId)},O=async()=>{if(j){p(null);try{let e=await fetch("/api/member/bookings/cancel",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({eventId:j})}),t=await e.json().catch(()=>({}));if(!e.ok)throw Error(t.error||"Failed to cancel");p({type:"success",text:"Event cancelled."}),g(null),await v()}catch(e){p({type:"error",text:e instanceof Error?e.message:"Failed to cancel"})}}};return(0,n.jsx)("div",{className:"container profile-calendar-page",style:{paddingTop:"1.5rem",paddingBottom:"3rem"},children:(0,n.jsxs)("div",{className:"profile-calendar-layout",children:[(0,n.jsxs)("section",{className:"profile-calendar-section card card-elevated",children:[(0,n.jsxs)("div",{className:"profile-calendar-header",children:[(0,n.jsxs)("h2",{style:{margin:0,fontSize:"1.25rem"},children:[k," ",N]}),(0,n.jsxs)("div",{className:"profile-calendar-nav",children:[(0,n.jsx)("button",{type:"button",onClick:()=>t(new Date(N,w-1)),className:"profile-calendar-nav-btn","aria-label":"Previous month",children:"‹"}),(0,n.jsx)("button",{type:"button",onClick:()=>t(new Date(N,w+1)),className:"profile-calendar-nav-btn","aria-label":"Next month",children:"›"})]})]}),(0,n.jsxs)("div",{className:"profile-calendar-grid",children:[s.map(e=>(0,n.jsx)("div",{className:"profile-calendar-dow",style:{color:"var(--text-muted)",fontSize:"0.8rem"},children:e},e)),T.map((e,t)=>(0,n.jsx)("div",{className:"profile-calendar-day profile-calendar-day--blank"},"b-".concat(t))),D.map(e=>(0,n.jsx)("div",{className:"profile-calendar-day ".concat(E(e)?"profile-calendar-day--today":""," ").concat(F(e)?"profile-calendar-day--has-event":""),children:e},e))]}),(0,n.jsx)(l.default,{href:"/events",className:"btn btn-primary",style:{marginTop:"1rem"},children:"Camps & clinics"})]}),(0,n.jsxs)("section",{className:"profile-events-section card card-elevated",children:[(0,n.jsx)("h2",{style:{margin:"0 0 1rem",fontSize:"1.1rem"},children:"My events"}),u&&(0,n.jsx)("p",{role:"alert",style:{marginBottom:"1rem",padding:"0.5rem 0.75rem",borderRadius:"6px",fontSize:"0.9rem",background:"success"===u.type?"var(--success-bg, #d4edda)":"var(--error-bg, #f8d7da)",color:"success"===u.type?"var(--success-text, #155724)":"var(--error-text, #721c24)"},children:u.text}),o&&(0,n.jsx)("p",{className:"text-muted",children:"Loading events…"}),m&&(0,n.jsx)("p",{className:"text-muted",style:{color:"var(--error, #c00)"},children:m}),!o&&!m&&0===a.length&&(0,n.jsxs)("p",{className:"text-muted",children:["You have no booked events. ",(0,n.jsx)(l.default,{href:"/events",children:"Browse camps & clinics"})," to book."]}),!o&&!m&&a.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"profile-events-table-wrap",children:(0,n.jsxs)("table",{className:"profile-events-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Date"}),(0,n.jsx)("th",{children:"Start"}),(0,n.jsx)("th",{children:"End"}),(0,n.jsx)("th",{children:"Athlete / Team"}),(0,n.jsx)("th",{children:"Description"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:a.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsxs)("td",{children:[(0,n.jsx)("span",{className:"profile-event-dot","aria-hidden":!0}),new Date(e.date+"T12:00:00").toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"})]}),(0,n.jsx)("td",{children:e.startTime}),(0,n.jsx)("td",{children:e.endTime}),(0,n.jsx)("td",{children:x===e.eventId?(0,n.jsxs)("span",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap",alignItems:"center"},children:[(0,n.jsx)("input",{type:"text",value:f,onChange:e=>b(e.target.value),className:"input",style:{width:"10rem",padding:"0.25rem 0.5rem"},"aria-label":"Athlete name"}),(0,n.jsx)("button",{type:"button",className:"btn btn-primary",onClick:M,style:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},children:"Save"}),(0,n.jsx)("button",{type:"button",className:"btn",onClick:I,style:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},children:"Cancel"})]}):e.athleteName}),(0,n.jsx)("td",{children:e.title}),(0,n.jsxs)("td",{children:[(0,n.jsx)("span",{style:{textTransform:"capitalize"},children:e.status}),"upcoming"===e.status&&!e.canCancel&&(0,n.jsx)("span",{className:"text-muted",style:{display:"block",fontSize:"0.75rem",marginTop:"0.25rem"},children:"Cancel not allowed within 24 hours"})]}),(0,n.jsxs)("td",{children:["past"===e.status&&"—","upcoming"===e.status&&(0,n.jsxs)("span",{style:{display:"flex",gap:"0.5rem",flexWrap:"wrap"},children:[x!==e.eventId&&(0,n.jsx)("button",{type:"button",className:"btn",onClick:()=>A(e),style:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},children:"Edit"}),e.canCancel?(0,n.jsx)("button",{type:"button",className:"btn",onClick:()=>Y(e),style:{padding:"0.25rem 0.5rem",fontSize:"0.85rem"},children:"Cancel event"}):(0,n.jsx)("span",{className:"text-muted",style:{fontSize:"0.8rem"},children:"Can only cancel 24+ hrs before"})]})]})]},e.eventId))})]})}),a.length>0&&(0,n.jsx)("p",{className:"text-muted",style:{marginTop:"1rem",fontSize:"0.85rem"},children:"You can edit athlete name or cancel an upcoming event. Cancellation is only allowed at least 24 hours before the event start."})]}),j&&(0,n.jsx)("div",{role:"dialog","aria-modal":"true","aria-labelledby":"cancel-dialog-title",style:{position:"fixed",inset:0,background:"rgba(0,0,0,0.4)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:1e3},onClick:()=>g(null),children:(0,n.jsxs)("div",{className:"card card-elevated",style:{padding:"1.5rem",maxWidth:"22rem",margin:"1rem"},onClick:e=>e.stopPropagation(),children:[(0,n.jsx)("h3",{id:"cancel-dialog-title",style:{margin:"0 0 0.75rem"},children:"Cancel event?"}),(0,n.jsx)("p",{className:"text-muted",style:{marginBottom:"1rem",fontSize:"0.9rem"},children:"This will remove your booking. You can rebook from Camps & clinics if needed."}),(0,n.jsxs)("div",{style:{display:"flex",gap:"0.5rem",justifyContent:"flex-end"},children:[(0,n.jsx)("button",{type:"button",className:"btn",onClick:()=>g(null),children:"Keep booking"}),(0,n.jsx)("button",{type:"button",className:"btn btn-primary",onClick:O,children:"Yes, cancel my booking"})]})]})})]})]})})}},7648:function(e,t,a){"use strict";a.d(t,{default:function(){return r.a}});var n=a(2972),r=a.n(n)}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=713)}),_N_E=e.O()}]);